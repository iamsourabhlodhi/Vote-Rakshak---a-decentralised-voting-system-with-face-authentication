<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin Dashboard - Election Portal</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="strip"></div>
<header class="gov-header">
  <div style="display:flex;align-items:center;gap:10px;">
    <img class="ashoka" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Emblem_of_India.svg/500px-Emblem_of_India.svg.png" alt="">
    <div>
      <b>Vote Rakshak</b><br>
      <span style="font-size:12px;">Admin Control Panel</span>
    </div>
  </div>

  <nav class="top-links">
      <a href="/admin-dashboard">Home</a>
      <a href="#" id="logout">Logout</a>
  </nav>
</header>

<div class="container">

<!-- Add Candidate -->
<div class="card">
<h3 style="color:#0a2a63">Add New Candidate</h3>

<label class="label">Candidate Name</label>
<input id="candName" class="input" placeholder="Enter candidate name">

<button id="addCand" class="btn" style="margin-top:10px;">Add Candidate</button>

<p id="candMsg" class="small" style="margin-top:10px;">Candidate will appear in voting list</p>
</div>

<!-- Voter List -->
<div class="card">
<h3 style="color:#0a2a63">Registered Voters</h3>
<div id="voterArea" style="max-height:300px;overflow:auto;margin-top:8px"></div>
</div>

<!-- Candidate List -->
<div class="card">
<h3 style="color:#0a2a63">Candidate List</h3>
<div id="candidateList" style="margin-top:8px"></div>

<a href="/voter" class="btn secondary" style="margin-top:12px;display:inline-block;">Register New Voter (Camera)</a>
</div>

</div>

<script>
const token = localStorage.getItem("admin_token");
if(!token) location.href="/admin";

document.getElementById("logout").onclick = ()=>{
  localStorage.removeItem("admin_token");
  location.href="/admin";
};

document.getElementById("addCand").onclick = async ()=>{
  const name=document.getElementById("candName").value.trim();
  if(!name) return candMsg.innerText="Enter name";

  const res=await fetch("/admin/add_candidate",{
    method:"POST",
    headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
    body:JSON.stringify({name})
  });

  const d=await res.json();
  candMsg.innerText = res.ok ? "Candidate added âœ”" : d.error;
  loadCandidates();
};

async function loadVoters(){
  const res=await fetch("/admin/voters",{headers:{'Authorization':'Bearer '+token}});
  const data=await res.json();
  voterArea.innerHTML="";

  if(!data.length) return voterArea.innerHTML="<div class='small'>No voters</div>";

  let t=document.createElement("table");
  t.className="table";
  t.innerHTML="<thead><tr><th>Enrollment</th><th>Name</th></tr></thead>";
  let body=document.createElement("tbody");

  data.forEach(v=>{
    let row=document.createElement("tr");
    row.innerHTML=`<td>${v.enrollment}</td><td>${v.name}</td>`;
    body.appendChild(row);
  });

  t.appendChild(body);
  voterArea.appendChild(t);
}

async function loadCandidates(){
  const r=await fetch("/candidates");
  const d=await r.json();
  candidateList.innerHTML="";

  d.forEach(c=>{
    let el=document.createElement("div");
    el.className="candidate";
    el.innerHTML=`<strong>${c.id}. ${c.name}</strong><div class="badge">${c.votes}</div>`;
    candidateList.appendChild(el);
  });
}

loadVoters(); loadCandidates();
</script>

</body>
</html>
